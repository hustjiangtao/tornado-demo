{% extends '../base.html' %}

{% block content %}
<div class="content_box">
  {% if data %}
  {% set post = data.get('post', {}) %}
  <!-- post info -->
  <div id="post_detail">
    <p class="post_info">
      <span class="post_author">{{ post.get('author') }}</span>
      <span><a href="{{ post.get('original_url') }}" target="_blank">&#x1F517;原文链接</a></span>
      <br>
      <span class="post_time">{{ post.get('create_time').replace('-', ' 年 ', 1).replace('-', ' 月 ', 1) }} 日</span>
    </p>
    <h1 class="post_title">{{ post.get('title') }}</h1>
    <div class="post_content">{% raw post.get('content') %}</div>
    <button type="button" class="pure-button" onclick="to_update_post()">去修改</button>
  </div>
  <!-- post update -->
  <div id="post_update" style="display: none">
    <form class="pure-form pure-form-stacked">
      <fieldset class="post">
        <label for="post_update_title">标题</label>
        <input type="text" id="post_update_title" name="post_update_title" value="{{ post.get('title') }}">

        <label for="post_update_content">正文</label>
{#        <div id="post_update_content">{% raw post.get("content") %}</div>#}
        <div id="post_update_content"></div>

        <br>
        <div class="post_submit">
          <button type="button" class="pure-button pure-button-primary" id="post_update_submit">修改</button>
        </div>
      </fieldset>
    </form>
  </div>
  {% else %}
  <!-- post add -->
  <div id="post_add">
    <form class="pure-form pure-form-stacked">
      <fieldset class="post" >
        <label for="post_add_title">标题</label>
        <input type="text" id="post_add_title" name="post_add_title">

        <label for="post_add_content">正文</label>
        <div id="post_add_content"></div>

        <br>
        <div class="post_submit">
          <button type="button" class="pure-button pure-button-primary" id="post_add_submit">发布</button>
        </div>
      </fieldset>
    </form>
  </div>
  {% end %}
</div>
{% end %}
{% block foot_js %}
{#<script src="https://unpkg.com/wangeditor@3.1.1/release/wangEditor.min.js"></script>#}
<script src="{{ static_url('js/wangEditor.min.js') }}"></script>
<script>
    window.onload=function () {
        let E = window.wangEditor;
        {% if data %}
        // post update
        let editor_update = new E('#post_update_content');
        editor_update.create();
        editor_update.txt.html('{% raw post.get("content") %}');
        document.getElementById('post_update_submit').addEventListener('click', function () {
            update_post({{ post.get('id') }}, editor_update.txt.html());
        });
        {% else %}
        // post add
        let editor_add = new E('#post_add_content');
        editor_add.create();
        document.getElementById('post_add_submit').addEventListener('click', function () {
            add_post(editor_add.txt.html());
        });
        {% end %}
    }
</script>
{% end %}
